{
  "hash": "9f345ff399d3c8d57ee7ff6a28f47f47",
  "result": {
    "markdown": "# IM939 - Lab 6 Part 5 Simpson's Paradox\n\nIn the session 6 (week 7) video we discussed the Simpson's Paradox. You can explore some case studies in the **applet** by clicking [here](https://math.usu.edu/~schneit/Statlets/Simpson's%20Paradox/)\n\nHere we are going to look at the case study of **\"Expenditure data for developmentally-disabled California residents\"**. This dataset was adjusted (the original dataset you can find [here](www.StatLit.org/XLS/2014-Taylor-Mickel-Paradox-Data.xlsx)) in order to explain the Simpson's Paradox. You can read the research paper  \"Simpson’s Paradox A Data Set and Discrimination Case Study” that uses and explains this dataset [here](http://jse.amstat.org/v22n1/mickel.pdf)\nThere is also a [documentation of the dataset](http://www.amstat.org/publications/jse/v22n1/mickel/paradox_documentation.docx)\n\n## 1 Data\nHere are the key information from the dataset documentation file (every time I use \"\" below it is a cite from the dataset file).\n### Abstract:\n\"The State of California Department of Developmental Services (DDS) is responsible for allocating funds that support over 250,000 developmentally-disabled residents (e.g., intellectual disability, cerebral palsy, autism, etc.), called here also consumers. The dataset represents a sample of 1,000 of these consumers. Biographical characteristics and expenditure data (i.e., the dollar amount the State spends on each consumer in supporting these individuals and their families) are included in the data set for each consumer.\n\n### Source: \nThe data set originates from DDS’s “Client Master File.” In order to remain in compliance with California State Legislation, the data have been altered to protect the rights and privacy of specific individual consumers.\nThe data set is designed to represent a sample of 1,000 DDS consumers.\n\n### Variable Descriptions:\nA header line contains the name of the variables. There are no missing values. \n\nId: 5-digit, unique identification code for each consumer (similar to a social security number)\n\nAge Cohort: Binned age variable represented as six age cohorts (0-5, 6-12, 13-17, 18-21, 22-50, and 51+)\n\nAge: Unbinned age variable\n\nGender: Male or Female\n\nExpenditures: Dollar amount of annual expenditures spent on each consumer\n\nEthnicity: Eight ethnic groups (American Indian, Asian, Black, Hispanic, Multi-race, Native Hawaiian, Other, and White non-Hispanic).\n\n### Research problem\nThe data set and case study are based on a real-life scenario where there was a claim of discrimination based on ethnicity. The exercise highlights the importance of performing rigorous statistical analysis and how data interpretations can accurately inform or misguide decision makers.\" (Taylor, Mickel 2014)\n\n## 2 Reading the dataset\n\nYou should know the Pandas library already from the lab 1 with James. Here we are going to use it to explore the data and for pivot tables. \nIn the folder you downloaded from the Moodle you have a dataset called 'Lab 6 - Paradox Dataset'.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\ndf = pd.read_excel('data/Paradox_Dataset.xlsx')\n```\n:::\n\n\nA reminder: anything with a pd. prefix comes from pandas. This is particulary useful for preventing a module from overwriting inbuilt Python functionality.\n\nLet's have a look at our dataset\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Id</th>\n      <th>AgeCohort</th>\n      <th>Age</th>\n      <th>Gender</th>\n      <th>Expenditures</th>\n      <th>Ethnicity</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>10210</td>\n      <td>13-17</td>\n      <td>17</td>\n      <td>Female</td>\n      <td>2113</td>\n      <td>White not Hispanic</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10409</td>\n      <td>22-50</td>\n      <td>37</td>\n      <td>Male</td>\n      <td>41924</td>\n      <td>White not Hispanic</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>10486</td>\n      <td>0-5</td>\n      <td>3</td>\n      <td>Male</td>\n      <td>1454</td>\n      <td>Hispanic</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>10538</td>\n      <td>18-21</td>\n      <td>19</td>\n      <td>Female</td>\n      <td>6400</td>\n      <td>Hispanic</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>10568</td>\n      <td>13-17</td>\n      <td>13</td>\n      <td>Male</td>\n      <td>4412</td>\n      <td>White not Hispanic</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>995</th>\n      <td>99622</td>\n      <td>51 +</td>\n      <td>86</td>\n      <td>Female</td>\n      <td>57055</td>\n      <td>White not Hispanic</td>\n    </tr>\n    <tr>\n      <th>996</th>\n      <td>99715</td>\n      <td>18-21</td>\n      <td>20</td>\n      <td>Male</td>\n      <td>7494</td>\n      <td>Hispanic</td>\n    </tr>\n    <tr>\n      <th>997</th>\n      <td>99718</td>\n      <td>13-17</td>\n      <td>17</td>\n      <td>Female</td>\n      <td>3673</td>\n      <td>Multi Race</td>\n    </tr>\n    <tr>\n      <th>998</th>\n      <td>99791</td>\n      <td>6-12</td>\n      <td>10</td>\n      <td>Male</td>\n      <td>3638</td>\n      <td>Hispanic</td>\n    </tr>\n    <tr>\n      <th>999</th>\n      <td>99898</td>\n      <td>22-50</td>\n      <td>23</td>\n      <td>Male</td>\n      <td>26702</td>\n      <td>White not Hispanic</td>\n    </tr>\n  </tbody>\n</table>\n<p>1000 rows × 6 columns</p>\n</div>\n```\n:::\n:::\n\n\nWe have 6 columns (variables) in 1000 rows. Let's see what type of object is our dataset and what types of objects are in the dataset.\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ntype(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\npandas.core.frame.DataFrame\n```\n:::\n:::\n\n\n## 3 Exploring data\n### Missing values\nLet's check if we have any missing data\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\ndf.info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 1000 entries, 0 to 999\nData columns (total 6 columns):\n #   Column        Non-Null Count  Dtype \n---  ------        --------------  ----- \n 0   Id            1000 non-null   int64 \n 1   AgeCohort     1000 non-null   object\n 2   Age           1000 non-null   int64 \n 3   Gender        1000 non-null   object\n 4   Expenditures  1000 non-null   int64 \n 5   Ethnicity     1000 non-null   object\ndtypes: int64(3), object(3)\nmemory usage: 47.0+ KB\n```\n:::\n:::\n\n\nThe above tables shows that we have 1000 observations for each of 6 columns. \n\nLet's see if there are any unexpected values.\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nimport numpy as np\nnp.unique(df.AgeCohort)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```\narray([' 0-5', ' 51 +', '13-17', '18-21', '22-50', '6-12'], dtype=object)\n```\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nnp.unique(df.Age)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\narray([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,\n       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,\n       34, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45, 46, 48, 51, 52, 53, 54,\n       55, 56, 57, 59, 60, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73,\n       74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 85, 86, 88, 89, 90, 91, 94,\n       95])\n```\n:::\n:::\n\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nnp.unique(df.Gender)\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\narray(['Female', 'Male'], dtype=object)\n```\n:::\n:::\n\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\nnp.unique(df.Ethnicity)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\narray(['American Indian', 'Asian', 'Black', 'Hispanic', 'Multi Race',\n       'Native Hawaiian', 'Other', 'White not Hispanic'], dtype=object)\n```\n:::\n:::\n\n\nThere aren't any unexpected values in neither of these 4 variables. We didn't run this command for Expenditures on purpose, as this would return us too many values. An easier way to check this variable would be just a boxplot.\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\ndf.boxplot(column=['Age'])\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n<Axes: >\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-10-output-2.png){width=566 height=411}\n:::\n:::\n\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\ndf.boxplot(column=['Expenditures'])\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\n<Axes: >\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-11-output-2.png){width=592 height=411}\n:::\n:::\n\n\nLet's see a summary of data types we have here.\n\n### Data types\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\ndf.dtypes\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\nId               int64\nAgeCohort       object\nAge              int64\nGender          object\nExpenditures     int64\nEthnicity       object\ndtype: object\n```\n:::\n:::\n\n\nWe are creating a new categorical column cat_AgeCohort that would make our work a bit easier later. You can read more [here](https://pandas.pydata.org/pandas-docs/version/0.23.4/generated/pandas.Categorical.html)\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\ndf['cat_AgeCohort'] = pd.Categorical(df['AgeCohort'], \n                                     ordered=True, \n                                     categories=['0-5', '6-12', '13-17', '18-21', '22-50', '51 +'])\n```\n:::\n\n\nHere int64 mean 'a 64-bit integer' and 'object' are strings. This gives you also a hint they are different types of variables. The 'bit' refers to how long and precise the number is. Pandas uses data types from numpy ([pandas documentation](https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#basics-dtypes), [numpy documentation](https://numpy.org/doc/stable/user/basics.types.html?highlight=array%20interface)). \nIn our dataset three variables are numeric: Id, age are ordinal variables, Expenditures is a scale variable. AgeCohort is categorical and Gender and Ethnicity are nominal.  \nFor that reason 'data.describe' will bring us a summary of numeric variables only.\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\ndf.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Id</th>\n      <th>Age</th>\n      <th>Expenditures</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>1000.000000</td>\n      <td>1000.000000</td>\n      <td>1000.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>54662.846000</td>\n      <td>22.800000</td>\n      <td>18065.786000</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>25643.673401</td>\n      <td>18.462038</td>\n      <td>19542.830884</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>10210.000000</td>\n      <td>0.000000</td>\n      <td>222.000000</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>31808.750000</td>\n      <td>12.000000</td>\n      <td>2898.750000</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>55384.500000</td>\n      <td>18.000000</td>\n      <td>7026.000000</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>76134.750000</td>\n      <td>26.000000</td>\n      <td>37712.750000</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>99898.000000</td>\n      <td>95.000000</td>\n      <td>75098.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nIt doesn't make sense to plot not numeric variables or ids. That's why we are going to just plot age and expenditures.\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\ndf.plot(x = 'Age', y = 'Expenditures', kind='scatter')\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\n<Axes: xlabel='Age', ylabel='Expenditures'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-15-output-2.png){width=610 height=429}\n:::\n:::\n\n\nThe pattern of data is very interesting, expecially around x-values of ca. 25. The research paper can bring us more clarification.\n\n### Age\nThe crucial factor in this case study is age: \"As consumers get older, their financial needs increase as they move out of their parent’s home, etc. Therefore, it is expected that expenditures for older consumers will be higher than for the younger consumers\" \n\nIn the dataset we have two age variables that both refer to the same information - age of consumers. They are saved as two distinct data types: binned 'AgeCohort' and unbinned 'Age'. \n\n**Age categories** If you look at the binned one you will notice that the categories are somewhat interesting: \n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\ndf[['Age']].plot(kind='hist', ec='black')\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\n<Axes: ylabel='Frequency'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-16-output-2.png){width=593 height=411}\n:::\n:::\n\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\ndf[\"AgeCohort\"].describe() #we will receive the output for the categorical variable \"AgeCohort\"\ndf['cat_AgeCohort'].describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```\ncount       812\nunique        4\ntop       22-50\nfreq        226\nName: cat_AgeCohort, dtype: object\n```\n:::\n:::\n\n\nHere we will run a bar plot of age categories.\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\ndf['cat_AgeCohort'].value_counts().plot(kind=\"bar\")\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```\n<Axes: xlabel='cat_AgeCohort'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-18-output-2.png){width=575 height=455}\n:::\n:::\n\n\nThe default order of plot elements is 'value count'. For the age variable it might be more useful to look at the order chronologically.\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\n#using sns.countplot from seaborn we will plot AgeCohort\n#the order in plotting this variable is really crucial, we want to have sorted by age categories\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n#here is without sorting / ordering\n#sns.countplot(x=\"AgeCohort\", data=df)\n\n#here we plot the variable with sorting\nsns.countplot(x=\"cat_AgeCohort\", data=df)\n\n#You can try playing with the commands below too:\n#sns.countplot(x=\"AgeCohort\", data=df, order=df['AgeCohort'].value_counts().index)\n#sns.countplot(x=\"AgeCohort\", data=df, order=['0-5', '6-12', '13-17', '18-21', '22-50','51+'])\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```\n<Axes: xlabel='cat_AgeCohort', ylabel='count'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-19-output-2.png){width=593 height=429}\n:::\n:::\n\n\nWhy would the data be binned in such \"uneven\" categories like '0-5 years', '6-12' and '22-50'? Instead of even categories e.g. '0-10', '11-20', '21-30' etc. or every 5 years '0-5', '6-10' etc.?\n\nHere the age cohorts **were allocated based on the theory**, rather than based on data (this way we would have even number of people in each category) or based on logical age categories, e.g. every 5 or 10 years.\n\nThe authors explain: \"The cohorts are established based on the amount of financial support typically required during a particular life phase (...) The 0-5 cohort (preschool age) has the fewest needs and requires the least amount of funding (...) Those in the 51+ cohort have the most needs and require the most amount of funding\". You can read in more details in the paper. \n\n## 4 Exploratory analysis \n\n\nThe research question is: *are any demographics discriminated in distributions of the funds?*\n\nFollowing the authors:\n\"Discrimination exists in this case study if the amount of expenditures for a typical person in a group of consumers that share a common attribute (e.g., gender, ethnicity, etc.) is significantly different when compared to a typical person in another group. For example, discrimination based on gender would occur if the expenditures for a typical female are less than the amount for a typical male.\"\n\nWe are going to examine the data using plots for categorical data and pivot tables (cross-tables) with means.\n\"Pivot table reports are particularly useful in narrowing down larger data sets or analyzing relationships between data points.\" Pivot tables will help you understand what is Simpson's Paradox. \n\n### Age x expenditures\nLet's see how expenditures are distributed across age groups.\n\nWe are going to use a *swarm plot* which I believe works well here to notice the paradox and \"the points are adjusted (only along the categorical axis) so that they don’t overlap. This gives a better representation of the distribution of values, but it does not scale well to large numbers of observations. A swarm plot can be drawn on its own, but it is also a good complement to a box or violin plot in cases where you want to show all observations along with some representation of the underlying distribution.\" Read more [here](https://seaborn.pydata.org/generated/seaborn.swarmplot.html#seaborn.swarmplot)\n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nsns.catplot(x=\"AgeCohort\", y=\"Expenditures\", kind=\"swarm\", data=df)\n#you can also do a boxplot if you change kind=\"box\"\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 83.5% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 35.4% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 76.8% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 58.8% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 14.2% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 84.0% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 85.8% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 42.5% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 80.5% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 64.8% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 21.7% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 86.9% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-20-output-5.png){width=469 height=468}\n:::\n:::\n\n\n### Ethnicity\nEthnicity could be another discriminating factor. Let's check this here too by plotting expenditures by ethnicity.\n\nThese groups reflect the demographic profile of the State of California.\n\n::: {.cell execution_count=20}\n``` {.python .cell-code}\nsns.catplot(x=\"Ethnicity\", y=\"Expenditures\", kind=\"swarm\", data=df)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 50.1% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 64.6% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 10.2% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 11.5% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 25.6% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 58.6% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 69.4% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 18.6% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 23.1% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 34.9% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-21-output-5.png){width=473 height=468}\n:::\n:::\n\n\n### Gender\nGender could have been another discriminating factor (as gender based discrimination is also very common). It is not the case here. See below plots to confirm these. We are plotting expenditures by gender.\n\n::: {.cell execution_count=21}\n``` {.python .cell-code}\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n#sns.catplot(x=\"Gender\", y=\"Expenditures\", kind=\"swarm\", data=df)\n#you can create even a nicer plot than for ethnicity, using tips here https://seaborn.pydata.org/tutorial/categorical.html\n#It's a combination of swarmplot and violin plot to show each observation along with a summary of the distribution\n\ng = sns.catplot(x=\"Gender\", y=\"Expenditures\", kind=\"violin\", inner=None, data=df)\nsns.swarmplot(x=\"Gender\", y=\"Expenditures\", color=\"k\", size=3, data=df, ax=g.ax)\n```\n\n::: {.cell-output .cell-output-display execution_count=21}\n```\n<Axes: xlabel='Gender', ylabel='Expenditures'>\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/u2071219/anaconda3/envs/IM939/lib/python3.11/site-packages/seaborn/categorical.py:3544: UserWarning: 7.0% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.\n  warnings.warn(msg, UserWarning)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-22-output-3.png){width=469 height=468}\n:::\n:::\n\n\n### Mean Expenditures \nThis was a quick visual analysis. Let's check means to see how it looks like by age, ethnicity and gender.\nWhy would it be also good to check medians here?\n\n::: {.cell execution_count=22}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\n\n#By default the aggreggate function is mean\n\nnp.round(df.pivot_table(index=['Ethnicity'], values=['Expenditures']), 2)\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Expenditures</th>\n    </tr>\n    <tr>\n      <th>Ethnicity</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>American Indian</th>\n      <td>36438.25</td>\n    </tr>\n    <tr>\n      <th>Asian</th>\n      <td>18392.37</td>\n    </tr>\n    <tr>\n      <th>Black</th>\n      <td>20884.59</td>\n    </tr>\n    <tr>\n      <th>Hispanic</th>\n      <td>11065.57</td>\n    </tr>\n    <tr>\n      <th>Multi Race</th>\n      <td>4456.73</td>\n    </tr>\n    <tr>\n      <th>Native Hawaiian</th>\n      <td>42782.33</td>\n    </tr>\n    <tr>\n      <th>Other</th>\n      <td>3316.50</td>\n    </tr>\n    <tr>\n      <th>White not Hispanic</th>\n      <td>24697.55</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=23}\n``` {.python .cell-code}\nnp.round(df.pivot_table(index=['Gender'], values=['Expenditures']), 2)\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Expenditures</th>\n    </tr>\n    <tr>\n      <th>Gender</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Female</th>\n      <td>18129.61</td>\n    </tr>\n    <tr>\n      <th>Male</th>\n      <td>18001.20</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=24}\n``` {.python .cell-code}\nnp.round(df.pivot_table(index=['cat_AgeCohort'], values=['Expenditures']), 2)\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Expenditures</th>\n    </tr>\n    <tr>\n      <th>cat_AgeCohort</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6-12</th>\n      <td>2226.86</td>\n    </tr>\n    <tr>\n      <th>13-17</th>\n      <td>3922.61</td>\n    </tr>\n    <tr>\n      <th>18-21</th>\n      <td>9888.54</td>\n    </tr>\n    <tr>\n      <th>22-50</th>\n      <td>40209.28</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nWhat do these tables tell us? There is much discrepnacy in average results for ethnicity and age cohort. If we look at gender - there aren't many differences.\n\nPlease remember that in this case study \"the needs for consumers increase as they become older which results in higher expenditures\". This would explain age discrepancies a bit, but what about ethnicity?\n\n# 5 In-depth Analysis - Outliers\nLet's try to go a bit more in-depth .\nWe know that gender doesn't show many differences. In age there are not big differences except for one case. Let's focus on ethnicity then. \n\n*We are going to use Seaborn's 'catplot'. In the [documentation](https://seaborn.pydata.org/tutorial/categorical.html) we can read what are the error bars here: \"In seaborn, the barplot() function operates on a full dataset and applies a function to obtain the estimate (taking the mean by default). When there are multiple observations in each category, it also uses bootstrapping to compute a confidence interval around the estimate, which is plotted using error bars.\"*\n\n::: {.cell execution_count=25}\n``` {.python .cell-code}\nsns.catplot(x=\"Ethnicity\", y='Expenditures', \n            kind=\"bar\", data=df)\n\n#you can also run a nested table, but the chart might be more straightforward in analysis.\n#np.round(df.pivot_table(index=['cat_AgeCohort','Ethnicity'], values=['Expenditures']), 2)\n```\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-26-output-1.png){width=473 height=468}\n:::\n:::\n\n\n::: {.cell execution_count=26}\n``` {.python .cell-code}\nnp.round(df.pivot_table(index=['Ethnicity'], values=['Expenditures']), 2)\n```\n\n::: {.cell-output .cell-output-display execution_count=26}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Expenditures</th>\n    </tr>\n    <tr>\n      <th>Ethnicity</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>American Indian</th>\n      <td>36438.25</td>\n    </tr>\n    <tr>\n      <th>Asian</th>\n      <td>18392.37</td>\n    </tr>\n    <tr>\n      <th>Black</th>\n      <td>20884.59</td>\n    </tr>\n    <tr>\n      <th>Hispanic</th>\n      <td>11065.57</td>\n    </tr>\n    <tr>\n      <th>Multi Race</th>\n      <td>4456.73</td>\n    </tr>\n    <tr>\n      <th>Native Hawaiian</th>\n      <td>42782.33</td>\n    </tr>\n    <tr>\n      <th>Other</th>\n      <td>3316.50</td>\n    </tr>\n    <tr>\n      <th>White not Hispanic</th>\n      <td>24697.55</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nSo there are big differences in the averages between ethnicities. Does it mean there is discrimination? \n\n::: {.cell execution_count=27}\n``` {.python .cell-code}\ndf.groupby('Ethnicity').count()\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Id</th>\n      <th>AgeCohort</th>\n      <th>Age</th>\n      <th>Gender</th>\n      <th>Expenditures</th>\n      <th>cat_AgeCohort</th>\n    </tr>\n    <tr>\n      <th>Ethnicity</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>American Indian</th>\n      <td>4</td>\n      <td>4</td>\n      <td>4</td>\n      <td>4</td>\n      <td>4</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>Asian</th>\n      <td>129</td>\n      <td>129</td>\n      <td>129</td>\n      <td>129</td>\n      <td>129</td>\n      <td>108</td>\n    </tr>\n    <tr>\n      <th>Black</th>\n      <td>59</td>\n      <td>59</td>\n      <td>59</td>\n      <td>59</td>\n      <td>59</td>\n      <td>49</td>\n    </tr>\n    <tr>\n      <th>Hispanic</th>\n      <td>376</td>\n      <td>376</td>\n      <td>376</td>\n      <td>376</td>\n      <td>376</td>\n      <td>315</td>\n    </tr>\n    <tr>\n      <th>Multi Race</th>\n      <td>26</td>\n      <td>26</td>\n      <td>26</td>\n      <td>26</td>\n      <td>26</td>\n      <td>19</td>\n    </tr>\n    <tr>\n      <th>Native Hawaiian</th>\n      <td>3</td>\n      <td>3</td>\n      <td>3</td>\n      <td>3</td>\n      <td>3</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>Other</th>\n      <td>2</td>\n      <td>2</td>\n      <td>2</td>\n      <td>2</td>\n      <td>2</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>White not Hispanic</th>\n      <td>401</td>\n      <td>401</td>\n      <td>401</td>\n      <td>401</td>\n      <td>401</td>\n      <td>315</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nAs you can see there are big sample size differences between ethnic groups. \n\n*What conclusions does it bring?*\nThere are 3 major ethnicities within the dataset: White non-Hispanic (40%), Hispanic (38%), Asian (13%). The sample sizes of other ethnicites are very small. \n\nPlease also remember that \n1). \nWe know it is representative data of the population of residents. So based on this data we can use inferential statistics (look up Week 03 slides if you need a reminder) and estimate results for the whole population of beneficiaries of California DDS. \n\n\n2).\nAlso, if you look into actual demographics of California State [here](https://en.wikipedia.org/wiki/Demographics_of_California#/media/File:Ethic_California_Organized_Pie.png)\n\nYou will notce that the proportions of the state are similar to proportions of this case study. Hispanic and White non-Hispanic constitute a majority of California's population.\n\nLet's focus on the top 2 biggest groups. We can see there is a difference in the average expenditures between the White non-Hispanic and Hispanic groups.\n\n::: {.cell execution_count=28}\n``` {.python .cell-code}\n##selecting cases that are either 'Hispanic' or 'White non Hispanic' \nHispanic = df[(df[\"Ethnicity\"] == 'Hispanic') | (df[\"Ethnicity\"] == 'White not Hispanic')]\nHispanic\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Id</th>\n      <th>AgeCohort</th>\n      <th>Age</th>\n      <th>Gender</th>\n      <th>Expenditures</th>\n      <th>Ethnicity</th>\n      <th>cat_AgeCohort</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>10210</td>\n      <td>13-17</td>\n      <td>17</td>\n      <td>Female</td>\n      <td>2113</td>\n      <td>White not Hispanic</td>\n      <td>13-17</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10409</td>\n      <td>22-50</td>\n      <td>37</td>\n      <td>Male</td>\n      <td>41924</td>\n      <td>White not Hispanic</td>\n      <td>22-50</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>10486</td>\n      <td>0-5</td>\n      <td>3</td>\n      <td>Male</td>\n      <td>1454</td>\n      <td>Hispanic</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>10538</td>\n      <td>18-21</td>\n      <td>19</td>\n      <td>Female</td>\n      <td>6400</td>\n      <td>Hispanic</td>\n      <td>18-21</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>10568</td>\n      <td>13-17</td>\n      <td>13</td>\n      <td>Male</td>\n      <td>4412</td>\n      <td>White not Hispanic</td>\n      <td>13-17</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>992</th>\n      <td>99114</td>\n      <td>18-21</td>\n      <td>18</td>\n      <td>Male</td>\n      <td>5298</td>\n      <td>Hispanic</td>\n      <td>18-21</td>\n    </tr>\n    <tr>\n      <th>995</th>\n      <td>99622</td>\n      <td>51 +</td>\n      <td>86</td>\n      <td>Female</td>\n      <td>57055</td>\n      <td>White not Hispanic</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>996</th>\n      <td>99715</td>\n      <td>18-21</td>\n      <td>20</td>\n      <td>Male</td>\n      <td>7494</td>\n      <td>Hispanic</td>\n      <td>18-21</td>\n    </tr>\n    <tr>\n      <th>998</th>\n      <td>99791</td>\n      <td>6-12</td>\n      <td>10</td>\n      <td>Male</td>\n      <td>3638</td>\n      <td>Hispanic</td>\n      <td>6-12</td>\n    </tr>\n    <tr>\n      <th>999</th>\n      <td>99898</td>\n      <td>22-50</td>\n      <td>23</td>\n      <td>Male</td>\n      <td>26702</td>\n      <td>White not Hispanic</td>\n      <td>22-50</td>\n    </tr>\n  </tbody>\n</table>\n<p>777 rows × 7 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=29}\n``` {.python .cell-code}\nnp.round(Hispanic.pivot_table(index=['Ethnicity', 'cat_AgeCohort'], values=['Expenditures']), 2)\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>Expenditures</th>\n    </tr>\n    <tr>\n      <th>Ethnicity</th>\n      <th>cat_AgeCohort</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"4\" valign=\"top\">Hispanic</th>\n      <th>6-12</th>\n      <td>2312.19</td>\n    </tr>\n    <tr>\n      <th>13-17</th>\n      <td>3955.28</td>\n    </tr>\n    <tr>\n      <th>18-21</th>\n      <td>9959.85</td>\n    </tr>\n    <tr>\n      <th>22-50</th>\n      <td>40924.12</td>\n    </tr>\n    <tr>\n      <th rowspan=\"4\" valign=\"top\">White not Hispanic</th>\n      <th>6-12</th>\n      <td>2052.26</td>\n    </tr>\n    <tr>\n      <th>13-17</th>\n      <td>3904.36</td>\n    </tr>\n    <tr>\n      <th>18-21</th>\n      <td>10133.06</td>\n    </tr>\n    <tr>\n      <th>22-50</th>\n      <td>40187.62</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=30}\n``` {.python .cell-code}\nsns.catplot(x=\"cat_AgeCohort\", y='Expenditures', hue=\"Ethnicity\", kind=\"bar\", data=Hispanic)\n```\n\n::: {.cell-output .cell-output-display}\n![](IM939_Lab_6_5-Simpsons_Paradox_files/figure-html/cell-31-output-1.png){width=620 height=468}\n:::\n:::\n\n\nLet's get back to our original question : does discrimination exist in this case? \n\n“Is the typical Hispanic consumer receiving fewer funds (i.e., expenditures) than the typical White non-Hispanic consumer? If a Hispanic consumer was to file for discrimination based upon ethnicity, s/he would more than likely be asked his/her age. Since the typical amount of expenditures for Hispanics (in all but one age cohort) is higher than the typical amount of expenditures for White non-Hispanics in the respective age cohort, the discrimination claim would be refuted\".\n\nThis case study shows **Simpson's Paradox**. \nYou may ask: \"Why is the overall average for all consumers significantly different indicating ethnic discrimination of Hispanics, yet in all but one age cohort (18-21) the average of expenditures for Hispanic consumers are greater than those of the White non-Hispanic population?\" Look at the table below.\n\n::: {.cell execution_count=31}\n``` {.python .cell-code}\npd.crosstab([Hispanic.cat_AgeCohort],Hispanic.Ethnicity)\n```\n\n::: {.cell-output .cell-output-display execution_count=31}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Ethnicity</th>\n      <th>Hispanic</th>\n      <th>White not Hispanic</th>\n    </tr>\n    <tr>\n      <th>cat_AgeCohort</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6-12</th>\n      <td>91</td>\n      <td>46</td>\n    </tr>\n    <tr>\n      <th>13-17</th>\n      <td>103</td>\n      <td>67</td>\n    </tr>\n    <tr>\n      <th>18-21</th>\n      <td>78</td>\n      <td>69</td>\n    </tr>\n    <tr>\n      <th>22-50</th>\n      <td>43</td>\n      <td>133</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n**Results**\n\n\"There are more Hispanics in the youngest four age cohorts, while the White non-Hispanics have more consumers in the oldest two age cohorts. The two populations are close in overall counts (376 vs. 401).  On top of this, consumers expenditures increase as they age to see the paradox.\n\nExpenditure average for Hispanic consumers are higher in all but one of the age cohorts, but the trend reverses when the groups are combined resulting in a lower expenditure average for all Hispanic consumers when compared to all White non-Hispanics.\"\n\n\"The overall Hispanic consumer population is a relatively younger when compared to the White non-Hispanic consumer population. Since the expenditures for younger consumers is lower, the overall average of expenditures for Hispanics\n(vs White non-Hispanics) is less.\"\n\n::: {.cell execution_count=32}\n``` {.python .cell-code}\npd.crosstab(Hispanic.cat_AgeCohort,Hispanic.Ethnicity, \n            normalize='columns')\n\n# values=Hispanic.Ethnicity,aggfunc=sum,\n```\n\n::: {.cell-output .cell-output-display execution_count=32}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Ethnicity</th>\n      <th>Hispanic</th>\n      <th>White not Hispanic</th>\n    </tr>\n    <tr>\n      <th>cat_AgeCohort</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>6-12</th>\n      <td>0.288889</td>\n      <td>0.146032</td>\n    </tr>\n    <tr>\n      <th>13-17</th>\n      <td>0.326984</td>\n      <td>0.212698</td>\n    </tr>\n    <tr>\n      <th>18-21</th>\n      <td>0.247619</td>\n      <td>0.219048</td>\n    </tr>\n    <tr>\n      <th>22-50</th>\n      <td>0.136508</td>\n      <td>0.422222</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n# 6 Conclusions\n## Explanation\n\n\"This exercise is based on a real-life case in California. The situation involved an alleged case of discrimination privileging White non-Hispanics over Hispanics in the allocation of funds to over 250,000 developmentally-disabled California residents. \n\nA number of years ago, an allegation of discrimination was made and supported by a univariate analysis that examined average annual expenditures on consumers by ethnicity. The analysis revealed that the average annual expenditures on Hispanic consumers was approximately one-third (⅓) of the average expenditures on White non-Hispanic consumers. (...) A bivariate analysis examining ethnicity and age (divided into six age cohorts) revealed that ethnic discrimination did not exist. Moreover, in all but one of the age cohorts, the trend reversed where the average annual expenditures on White non-Hispanic consumers were less than the expenditures on Hispanic consumers.\"(Taylor, Mickel 2014)\n\nWhen running the simple table with aggregated data, the discrimination in this case appared evident. After running a few more detailed tables, it appears to be no evidence of discrimination based on this sample and the variables collected.\n\n## Takeaways\nThe example above concerns a crucial topic of discrimination. \nAs you can see, data and statistics alone won't give us the anwser. First results might give us a confusing result. Critical thinking is essential when working with data, in order to account for reasons not evident at the first sight. The authors remind us the following: 1) \"outcome of important decisions (such as discrimination claims) are often heavily influenced by statistics and how an incomplete analysis may lead to poor decision making\"\n2) \"importance of identifying and analyzing all sources of specific variation (i.e., potential influential factors) in statistical analyses\". This is something we already discussed in previous weeks, but it is never enough to stress it out\"\n\n### *Additional Links\nSome links regarding categorical data in Python for those interested:\n\n\nhttps://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html#description\n\nhttps://pandas.pydata.org/pandas-docs/version/0.23.1/generated/pandas.DataFrame.plot.bar.html\n\nhttps://seaborn.pydata.org/tutorial/categorical.html\n\nhttps://seaborn.pydata.org/generated/seaborn.countplot.html\n\n",
    "supporting": [
      "IM939_Lab_6_5-Simpsons_Paradox_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}